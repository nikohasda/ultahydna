<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momen Spesial: Teka-Teki Cinta</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Canvas Confetti CDN for realistic confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <!-- Google Font for Handwriting Style -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom font for better aesthetics */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FCE4EC; /* Light Pink background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333333; /* Dark text color for contrast */
            overflow: hidden; /* Hide overflow for confetti */
        }
        .quiz-container {
            background-color: #F8BBD0; /* Pink 200 for container */
            padding: 2.5rem; /* Increased padding */
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); /* Softer shadow */
            text-align: center;
            max-width: 90%; /* Ensure responsiveness */
            width: 500px; /* Max width for desktop */
            animation: fadeIn 1s ease-out;
            position: relative; /* For confetti positioning */
            z-index: 10; /* Ensure container is above confetti */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Feminine animation for the birthday message and new titles */
        .message-animation {
            /* popIn runs once, then blink and sparkle loop */
            animation: popIn 1s ease-out forwards,
                        blink 1.5s infinite alternate 1s, /* Starts after popIn, loops */
                        sparkle 1s infinite alternate 1s; /* Starts after popIn, loops */
            opacity: 0; /* Initial state for popIn */
            transform: scale(0.8); /* Initial state for popIn */
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            70% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* Blink animation */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; } /* Subtle blink effect */
        }

        /* Sparkle animation using text-shadow */
        @keyframes sparkle {
            0%, 100% {
                text-shadow: 0 0 5px #FFDAB9, /* Light peach glow */
                             0 0 10px #FFC0CB; /* Light pink glow */
            }
            50% {
                text-shadow: 0 0 10px #FF69B4, /* Hot pink glow */
                             0 0 20px #FF1493; /* Deep pink glow */
            }
        }

        .quiz-item {
            margin-bottom: 1.5rem; /* Space between quiz items */
        }
        .quiz-label {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #424242;
        }
        .quiz-input {
            width: calc(100% - 2rem); /* Full width minus padding */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid #F48FB1; /* Pink 300 border */
            background-color: #FFFFFF;
            color: #333333;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .quiz-input:focus {
            outline: none;
            border-color: #D81B60; /* Pink 700 on focus */
            box-shadow: 0 0 0 3px rgba(216, 27, 96, 0.3); /* Focus ring */
        }

        /* Styling for date dropdowns */
        .date-dropdowns {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }
        .date-dropdowns select {
            padding: 0.75rem 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid #F48FB1;
            background-color: #FFFFFF;
            color: #333333;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex: 1; /* Allow dropdowns to grow */
            min-width: 80px; /* Minimum width for each dropdown */
        }
        .date-dropdowns select:focus {
            outline: none;
            border-color: #D81B60;
            box-shadow: 0 0 0 3px rgba(216, 27, 96, 0.3);
        }

        /* Full-screen message styling */
        .full-screen-message {
            position: fixed; /* Use fixed to ensure it covers the whole viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #FCE4EC; /* Match body background */
            z-index: 20; /* Ensure it's above everything else */
            text-align: center;
            padding: 1rem; /* Add some padding */
            transition: opacity 0.5s ease-in-out; /* Smooth fade transition */
        }

        /* Responsive font sizes for the message */
        .message-text {
            font-size: 3rem; /* Default for smaller screens */
            line-height: 1.2;
        }
        @media (min-width: 640px) { /* sm */
            .message-text {
                font-size: 4rem;
            }
        }
        @media (min-width: 768px) { /* md */
            .message-text {
                font-size: 5rem;
            }
        }
        @media (min-width: 1024px) { /* lg */
            .message-text {
                font-size: 6rem;
            }
        }
        @media (min-width: 1280px) { /* xl */
            .message-text {
                font-size: 7rem;
            }
        }

        /* New styles for letter and collage layout */
        .full-screen-layout {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column; /* Default to column for mobile */
            background-color: #FCE4EC; /* Match body background */
            z-index: 20; /* Above countdown, below message */
            opacity: 0; /* Initially hidden for fade-in */
            transition: opacity 0.5s ease-in-out; /* Smooth fade transition */
        }
        .full-screen-layout.visible {
            opacity: 1; /* Make visible for fade-in */
        }
        @media (min-width: 768px) {
            .full-screen-layout {
                flex-direction: row; /* Side-by-side on larger screens */
            }
        }

        /* Letter and Collage Section Sizing & Styling */
        .letter-section, .collage-section {
            display: flex;
            flex-direction: column; /* For content alignment */
            justify-content: center;
            align-items: center;
            padding: 1.5rem; /* Adjusted padding for lines */
            overflow: hidden; /* Ensure no scrollbar and content is clipped if too long */
            box-sizing: border-box; /* Include padding in width/height */
        }

        .letter-section {
            background-color: #FFFFFF; /* White paper */
            border: 1px solid #e0e0e0; /* Subtle border */
            background-image:
                linear-gradient(to right, #FFDAB9 1px, transparent 1px), /* Vertical margin line (Peach) */
                linear-gradient(to bottom, #e0e0e0 1px, transparent 1px); /* Horizontal lines (Light Grey) */
            background-size: 1px 100%, 100% 52px; /* Doubled line height for larger font */
            background-position: 20px 0, 0 10px; /* Vertical line at 20px from left, Horizontal lines start at 10px from top */
            background-repeat: no-repeat, repeat-y; /* Vertical line no-repeat, horizontal lines repeat vertically */
            background-attachment: local; /* Lines scroll with content */

            border-radius: 1rem;
            margin: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); /* Slightly more prominent shadow */
            max-width: 95%; /* Ensure content fits within section */
            max-height: 95%; /* Ensure content fits within section */
            text-align: left; /* Ensure text aligns left within the box */
            padding: 10px 1.5rem 10px 30px; /* Adjusted padding to align text with lines: top 10px, left 20px (margin) + 10px (text padding) */
            line-height: 52px; /* Doubled line height */
            font-size: 2.2rem; /* Doubled font size */
            font-family: 'Dancing Script', cursive; /* Apply handwriting font */
            flex: 1; /* Take remaining space in column layout */
        }
        @media (min-width: 768px) {
            .letter-section {
                flex: 0 0 70%; /* 70% width on larger screens */
                margin-right: 0; /* Adjust margins when side-by-side */
                border-radius: 1rem 0 0 1rem; /* Rounded left corners */
                overflow-y: auto; /* Enable manual scroll for desktop */
            }
        }
        @media (max-width: 767px) { /* Mobile specific styles */
            .letter-section {
                font-size: 1.5rem; /* Doubled font size for mobile */
                margin: 0.5rem;
                padding: 8px 1rem 8px 35px; /* Adjusted padding */
                background-size: 1px 100%, 100% 40px; /* Doubled horizontal line size */
                background-position: 25px 0, 0 8px; /* Adjusted line positions */
                line-height: 40px; /* Doubled line height for mobile */
                overflow-y: hidden; /* Hide scrollbar for auto-scroll */
            }
        }
        
        /* Specific styling for typed content within the letter section */
        .letter-typed-area {
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align content to the top */
            align-items: flex-start; /* Align content to the left */
            padding-top: 10px; /* Add padding to align with first line */
            box-sizing: border-box; /* Include padding in width/height */
        }

        #poemContentScroller {
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Align content to the left */
            width: 100%;
            will-change: transform; /* Optimize for animation */
            /* Animation will be applied by JS for mobile */
        }

        .letter-typed-area h2 {
            text-align: center; /* Centered now */
            margin-bottom: 52px; /* Doubled margin-bottom */
            line-height: 52px; /* Doubled line height */
            padding: 0;
            text-indent: 0; /* Ensure no indent */
            font-size: 3rem; /* Doubled font size */
            font-weight: 700; /* Bolder weight for Dancing Script */
            color: #D81B60; /* Pink 700 for title */
            font-family: 'Dancing Script', cursive; /* Apply handwriting font */
            width: 100%; /* Take full width for centering */
        }
        @media (max-width: 767px) {
            .letter-typed-area h2 {
                font-size: 2rem; /* Doubled title font for mobile */
                line-height: 40px;
                margin-bottom: 40px;
            }
        }

        .letter-typed-area p {
            text-indent: 0; /* REMOVED text-indent to align wrapped lines */
            margin-bottom: 0; /* Remove default paragraph margins to align with lines */
            padding: 0;
            line-height: 52px; /* Doubled line height */
            font-size: 2.2rem; /* Doubled font size */
            text-align: left; /* Ensure left alignment */
            font-family: 'Dancing Script', cursive; /* Apply handwriting font */
        }
        @media (max-width: 767px) {
            .letter-typed-area p {
                font-size: 1.5rem; /* Doubled paragraph font for mobile */
                line-height: 40px;
            }
        }

        /* Typing animation cursor */
        .letter-typed-area span.typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.1em; /* Adjust to font size */
            background-color: currentColor;
            animation: blink-cursor 0.8s infinite;
            vertical-align: middle;
            margin-left: 2px;
        }
        @keyframes blink-cursor {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Styling for the signature */
        .letter-typed-area .signature-line { /* Changed to signature-line for consistency */
            font-weight: 700; /* Bolder weight for Dancing Script */
            font-size: 3rem; /* Doubled font size */
            margin-top: 52px; /* Doubled margin-top */
            text-align: right; /* Align signature to the right */
            padding-right: 1.5rem; /* Match right padding of the letter section */
            width: 100%; /* Ensure it takes full width for right alignment */
            box-sizing: border-box; /* Include padding in width */
            font-family: 'Dancing Script', cursive; /* Apply handwriting font */
        }
        @media (max-width: 767px) {
            .letter-typed-area .signature-line {
                font-size: 2rem; /* Doubled signature font for mobile */
                margin-top: 40px; /* Doubled margin-top */
            }
        }


        .collage-section {
            background-color: #E1F5FE; /* Light blue background for collage */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow-y: hidden; /* Hide vertical scrollbar for the section itself */
            flex: 1; /* Take remaining space in column layout */
        }
        @media (min-width: 768px) {
            .collage-section {
                flex: 0 0 30%; /* 30% width on larger screens */
                margin-left: 0; /* Adjust margins when side-by-side */
                border-radius: 0 1rem 1rem 0; /* Rounded right corners */
            }
        }

        #imageCarousel {
            display: flex; /* Display images in a column */
            flex-direction: column;
            align-items: center; /* Center images horizontally */
            flex-shrink: 0; /* Prevent the carousel itself from shrinking */
            width: 100%; /* Take full width of the container */
            padding: 1rem 0; /* Add some vertical padding */
            /* Animation will be added here by JS */
        }
        
        .collage-image {
            flex-shrink: 0; /* Prevent images from shrinking */
            width: 90%; /* Take up most of the width of the section */
            max-width: 250px; /* Maximum width for each image */
            height: auto; /* Maintain aspect ratio */
            object-fit: contain; /* Maintain aspect ratio */
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem; /* Space between images vertically */
            opacity: 1;
            transition: none; /* No individual fade transition on images for continuous scroll */
        }

        /* Animation for vertical scrolling - defined dynamically by JS */
        /* @keyframes scrollUp { ... } */

        /* Adjust font sizes for letter on smaller screens */
        @media (max-width: 767px) {
            .collage-image {
                width: 180px; /* Smaller width for mobile */
                margin-right: 0; /* No horizontal margin on mobile in vertical stack */
                margin-bottom: 0.5rem; /* Smaller vertical margin on mobile */
            }
        }

        /* Music illustration styling */
        #musicIllustration {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(248, 187, 208, 0.8); /* Pink 200 with transparency */
            padding: 8px 15px;
            border-radius: 9999px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            color: #D81B60; /* Pink 700 for notes */
            font-size: 1.5rem; /* Larger for visibility */
            z-index: 30;
            opacity: 0; /* Initially hidden */
            display: flex;
            align-items: center;
            gap: 5px;
            transition: opacity 0.5s ease-in-out;
        }

        .music-note {
            animation: pulse 1s infinite alternate;
        }
        .music-note:nth-child(2) {
            animation-delay: 0.2s; /* Stagger animation */
        }
        .music-note:nth-child(3) {
            animation-delay: 0.4s; /* Stagger animation */
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Custom Modal Styling for messages */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Above everything else */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #F8BBD0; /* Pink 200 */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
            color: #333333;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-overlay.visible .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-content h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #D81B60; /* Pink 700 */
        }
        .modal-content p {
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        .modal-close-button {
            background-color: #D81B60; /* Pink 700 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease-in-out;
        }
        .modal-close-button:hover {
            background-color: #AD1457; /* Darker Pink */
        }
    </style>
</head>
<body>
    <!-- The message will now be a full-screen overlay, outside the quiz-container -->
    <p id="countdown-message" class="text-pink-700 font-extrabold hidden"></p>

    <!-- Quiz Container -->
    <div class="quiz-container" id="mainQuizContainer">
        <h1 id="quizTitle" class="text-4xl font-bold mb-6 text-gray-800">Uji Ingatanmu, Sayang!</h1>
        <p id="quizSubtitle" class="text-lg mb-8 text-gray-600">Jawablah pertanyaan-pertanyaan ini untuk melanjutkan.</p>

        <div class="quiz-item">
            <label for="q1" class="quiz-label block">1. Tahun berapa kita mulai kenal?</label>
            <input type="text" id="q1" class="quiz-input" placeholder="">
        </div>
        <div class="quiz-item">
            <label class="quiz-label block">2. Kapan tanggal, hari, dan tahun jadian kita?</label>
            <div class="date-dropdowns">
                <select id="q2-day" class="quiz-input"></select>
                <select id="q2-month" class="quiz-input"></select>
                <select id="q2-year" class="quiz-input"></select>
            </div>
        </div>
        <div class="quiz-item">
            <label class="quiz-label block">3. Kapan kita menikah?</label>
            <div class="date-dropdowns">
                <select id="q3-day" class="quiz-input"></select>
                <select id="q3-month" class="quiz-input"></select>
                <select id="q3-year" class="quiz-input"></select>
            </div>
        </div>

        <!-- Submit Button -->
        <button id="submitQuizButton" class="mt-8 px-6 py-3 bg-pink-500 text-white font-bold rounded-full shadow-lg hover:bg-pink-600 transition-colors duration-300 transform hover:scale-105">
            Kirim Jawaban
        </button>
    </div>

    <!-- New container for letter and collage, initially hidden -->
    <div id="letterAndCollageContainer" class="hidden full-screen-layout">
        <div class="letter-section">
            <!-- Added letter-typed-area to apply specific styling for content within the letter -->
            <div class="letter-typed-area">
                <div id="poemContentScroller">
                    <h2 class="h2-title">Selamat ulang tahun, Sayang!</h2>
                    <p>Tak terasa, sudah berapa banyak tahun yang kita lewati bersama. Mengingat kembali hari lahirmu tanggal 17 Juli, rasanya baru kemarin kita bertemu di tahun 2014. Sejak itu, duniaku jadi jauh lebih berwarna.</p>
                    <p></p>
                    <p>Aku masih ingat jelas tanggal 14 September 2016, hari kita resmi jadian. Rasanya seperti baru kemarin kita memulai kisah cinta kita, penuh tawa, cerita, dan semua suka duka yang kita bagi. Dan puncaknya, tanggal 29 November 2022, kita berjanji untuk selalu bersama. Setiap hari bersamamu adalah anugerah terindah.</p>
                    <p></p>
                    <p>Terima kasih sudah menjadi istri yang luar biasa, teman hidup yang selalu mendukung, dan belahan jiwaku. Kamu adalah segalanya bagiku, Yul. Aku berharap kamu selalu bahagia, sehat, dan semua impianmu bisa tercapai.</p>
                    <p></p>
                    <p>Aku mencintaimu, sekarang dan selamanya.</p>
                    <p></p>
                    <p>Dengan segenap hati,</p>
                    <p></p>
                    <p class="signature-line">Niko Hasda Prayogo</p>
                </div>
            </div>
        </div>
        <div class="collage-section">
            <div id="imageCarousel">
                <!-- Images will be populated here statically by JS -->
            </div>
        </div>
    </div>

    <!-- Audio Player - Autoplay enabled, no controls -->
    <!--
        CATATAN PENTING: File audio 'audio/music.mp3' harus tersedia di direktori yang sama
        atau diganti dengan URL publik agar musik dapat diputar.
    -->
    <audio id="backgroundMusic" loop>
        <source src="audio/music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Music Illustration Display -->
    <div id="musicIllustration">
        <!-- SVG for a single music note, repeated for effect -->
        <svg class="music-note" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
        <svg class="music-note" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
        <svg class="music-note" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
    </div>

    <!-- Custom Modal for messages -->
    <div id="customModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <p id="modalMessage"></p>
            <button id="modalCloseButton" class="modal-close-button">Tutup</button>
        </div>
    </div>

    <script>
        // Define SVG paths for heart and star shapes for confetti
        const heart = confetti.shapeFromPath({
            path: 'M10 3.2C10 1.6 8.4 0 6.8 0S3.2 1.6 3.2 3.2c0 1.6 1.6 3.2 3.2 4.8 1.6-1.6 3.2-3.2 3.2-4.8z',
            width: 10,
            height: 10
        });

        const star = confetti.shapeFromPath({
            path: 'M9.7 0.3L7.5 4.5L3 5.2L6.3 8.5L5.5 13L9.7 10.7L14 13L13.2 8.5L16.5 5.2L12 4.5L9.7 0.3z',
            width: 10,
            height: 10
        });

        // Array of image URLs for the collage
        // CATATAN PENTING: File gambar harus tersedia di direktori 'images/'
        // atau diganti dengan URL publik agar gambar dapat ditampilkan.
        const collageImages = [
            'images/1.jpg', 'images/2.jpg', 'images/3.jpg', 'images/4.jpg', 'images/5.jpg',
            'images/6.jpg', 'images/7.jpg', 'images/8.jpg', 'images/9.jpg', 'images/10.jpg',
            'images/11.jpg', 'images/12.jpg', 'images/13.jpg', 'images/14.jpg', 'images/15.jpg',
            'images/16.jpg', 'images/17.jpg', 'images/18.jpg', 'images/19.jpg', 'images/20.jpg',
            'images/21.jpg', 'images/22.jpg', 'images/23.jpg', 'images/24.jpg', 'images/25.jpg',
            'images/26.jpg', 'images/27.jpg', 'images/28.jpg', 'images/29.jpg', 'images/30.jpg',
            'images/31.jpg', 'images/32.jpg', 'images/33.jpg', 'images/34.jpg', 'images/35.jpg',
            'images/36.jpg', 'images/37.jpg', 'images/38.jpg', 'images/39.jpg', 'images/40.jpg',
            'images/41.jpg', 'images/42.jpg', 'images/43.jpg', 'images/44.jpg', 'images/45.jpg',
            'images/46.jpg', 'images/47.jpg', 'images/48.jpg', 'images/49.jpg', 'images/50.jpg',
            'images/51.jpg', 'images/52.jpg', 'images/53.jpg'
        ];
        
        // Audio elements
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicIllustration = document.getElementById('musicIllustration');

        // Flag to ensure music only attempts to play once on first interaction
        let musicPlayedOnce = false;

        // Function to show custom modal messages
        function showModal(title, message) {
            const modalOverlay = document.getElementById('customModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalCloseButton = document.getElementById('modalCloseButton');

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalOverlay.classList.remove('hidden');
            modalOverlay.classList.add('visible');

            modalCloseButton.onclick = () => {
                modalOverlay.classList.remove('visible');
                modalOverlay.classList.add('hidden');
            };
        }

        // Function to display poem lines with auto-scrolling for mobile
        function displayPoemLines() {
            const poemContentScroller = document.getElementById('poemContentScroller');
            
            // Duplicate content for seamless looping (only if on mobile)
            if (window.innerWidth <= 767) { // Check for mobile screen size
                const originalContent = poemContentScroller.innerHTML;
                // Duplicate content several times to ensure a long enough scroll
                poemContentScroller.innerHTML = originalContent + originalContent + originalContent; 
            }

            // Calculate total height for animation
            let totalPoemHeight = 0;
            const poemLines = poemContentScroller.children; // Get all direct children (h2, p)
            if (poemLines.length > 0) {
                // Use a temporary div to measure the actual content height without animation affecting it
                const tempDiv = document.createElement('div');
                tempDiv.style.visibility = 'hidden';
                tempDiv.style.position = 'absolute';
                tempDiv.style.width = poemContentScroller.offsetWidth + 'px'; // Match width
                tempDiv.style.fontFamily = window.getComputedStyle(poemContentScroller).fontFamily;
                tempDiv.style.fontSize = window.getComputedStyle(poemContentScroller).fontSize;
                tempDiv.style.lineHeight = window.getComputedStyle(poemContentScroller).lineHeight;
                tempDiv.innerHTML = poemContentScroller.children[0].outerHTML; // Start with title
                // Only measure one set of original content
                for (let i = 1; i < poemLines.length / (window.innerWidth <= 767 ? 3 : 1); i++) { 
                    if (poemLines[i]) { // Ensure element exists
                        tempDiv.innerHTML += poemLines[i].outerHTML;
                    }
                }
                document.body.appendChild(tempDiv);
                totalPoemHeight = tempDiv.scrollHeight; // Use scrollHeight to get full content height
                document.body.removeChild(tempDiv);
            }

            if (totalPoemHeight > 0 && window.innerWidth <= 767) { // Only animate on mobile
                const animationSpeedFactor = 10; // Adjust this value: higher = slower, lower = faster
                const animationDuration = totalPoemHeight / animationSpeedFactor; // seconds

                // Create dynamic keyframes for poem scrolling
                const styleSheet = document.createElement("style");
                styleSheet.type = "text/css";
                styleSheet.innerText = `
                    @keyframes scrollPoemUpDynamic {
                        0% { transform: translateY(0); }
                        100% { transform: translateY(-${totalPoemHeight}px); }
                    }
                `;
                document.head.appendChild(styleSheet);
                
                // Apply animation
                poemContentScroller.style.animation = `scrollPoemUpDynamic ${animationDuration}s linear infinite`;
                console.log(`Poem animation started: totalHeight=${totalPoemHeight}px, duration=${animationDuration}s`);
            } else {
                // Remove animation if not on mobile or height is zero
                poemContentScroller.style.animation = 'none';
                console.log("Poem animation not applied (desktop or zero height).");
            }
        }


        // Function to launch confetti
        function launchConfetti() {
            confetti({
                particleCount: 150, // More particles
                spread: 120, // Wider spread
                origin: { y: 0.6 }, // Start from slightly lower
                colors: ['#FFC0CB', '#FF69B4', '#FF1493', '#FFDAB9', '#F06290'], // Feminine color palette
                shapes: ['circle', 'square', heart, star], // Include heart and star shapes
                scalar: 1.2, // Make particles slightly larger
                disableForReducedMotion: true // Good accessibility practice
            });
        }

        // Function to display all collage images and start vertical scrolling
        function displayCollageImages() {
            const imageCarousel = document.getElementById('imageCarousel');
            imageCarousel.innerHTML = ''; // Clear any existing images

            // Duplicate images to create a seamless loop
            const duplicatedCollageImages = [...collageImages, ...collageImages, ...collageImages]; 
            
            duplicatedCollageImages.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                img.alt = "Kolase Foto";
                img.classList.add('collage-image');
                // Add onerror to display a placeholder if the image fails to load
                img.onerror = () => {
                    img.src = `https://placehold.co/250x250/cccccc/000000?text=Image+Error`;
                    console.error(`Failed to load image: ${src}. Displaying placeholder.`);
                };
                imageCarousel.appendChild(img);
            });

            // Calculate total height for animation
            // Wait for images to load to get accurate height
            let imagesLoadedCount = 0;
            let totalImagesHeight = 0;
            const imageMarginBottom = 16; // 1rem = 16px (from CSS margin-bottom: 1rem)

            // Function to calculate height after images are loaded
            const calculateAndAnimate = () => {
                totalImagesHeight = 0;
                // Sum up height of *one set* of original images
                for (let i = 0; i < collageImages.length; i++) {
                    const imgElement = imageCarousel.children[i];
                    if (imgElement && imgElement.complete) { // Ensure image is fully loaded
                        totalImagesHeight += imgElement.offsetHeight + imageMarginBottom;
                    } else if (imgElement) {
                        // If image not complete, try to use naturalHeight/Width or a fallback size
                        totalImagesHeight += 250 + imageMarginBottom; // Fallback to max-width size + margin
                    }
                }
                // Adjust for the last image's margin not contributing to scrollable height
                if (collageImages.length > 0) {
                    totalImagesHeight -= imageMarginBottom;
                }

                if (totalImagesHeight > 0) {
                    const animationSpeedFactor = 20; // Adjust this value: higher = slower, lower = faster
                    const animationDuration = totalImagesHeight / animationSpeedFactor; // seconds

                    // Create dynamic keyframes
                    const styleSheet = document.createElement("style");
                    styleSheet.type = "text/css";
                    styleSheet.innerText = `
                        @keyframes scrollUpDynamic {
                            0% { transform: translateY(0); }
                            100% { transform: translateY(-${totalImagesHeight}px); }
                        }
                    `;
                    document.head.appendChild(styleSheet);
                    
                    // Apply animation
                    imageCarousel.style.animation = `scrollUpDynamic ${animationDuration}s linear infinite`;
                    console.log(`Collage animation started: totalImagesHeight=${totalImagesHeight}px, duration=${animationDuration}s`);
                } else {
                    console.warn("Could not calculate total image height for collage animation.");
                }
            };

            // Load listener for each image to ensure height is calculated correctly
            duplicatedCollageImages.forEach((src, index) => {
                const imgElement = imageCarousel.children[index];
                if (imgElement) {
                    imgElement.onload = () => {
                        imagesLoadedCount++;
                        if (imagesLoadedCount === duplicatedCollageImages.length) {
                            // All images are loaded, now calculate and animate
                            calculateAndAnimate();
                        }
                    };
                    imgElement.onerror = () => {
                        console.error(`Failed to load image: ${src}`);
                        imagesLoadedCount++; // Still count as loaded to proceed
                        if (imagesLoadedCount === duplicatedCollageImages.length) {
                            calculateAndAnimate();
                        }
                    };
                }
            });

            // Fallback if images are cached or load too fast for onload to trigger calculation
            setTimeout(() => {
                if (imagesLoadedCount < duplicatedCollageImages.length) { // If not all images triggered onload
                    calculateAndAnimate();
                }
            }, 1500); // Give it a bit more time for images to load
        }


        // Function to trigger the end animation and message (after quiz is passed)
        function triggerEndAnimation() {
            document.getElementById('mainQuizContainer').classList.add('hidden'); // Hide the quiz container

            const messageElement = document.getElementById('countdown-message');
            messageElement.classList.remove('hidden'); // Show message
            messageElement.classList.add('full-screen-message', 'message-text');
            messageElement.innerHTML = 'Selamat Ulang Tahun Istriku<br>Yuli Dwi Nur Aini!';
            messageElement.classList.add('message-animation'); // Add feminine animation animation class

            // Trigger confetti 3 times with a 1-second delay between each
            launchConfetti();
            setTimeout(launchConfetti, 1000);
            setTimeout(launchConfetti, 2000);

            // Show the "Lanjut" button after all confetti bursts (2 seconds + animation duration)
            setTimeout(() => {
                const continueButton = document.createElement('button');
                continueButton.id = 'continueButton';
                continueButton.className = 'mt-8 px-6 py-3 bg-pink-500 text-white font-bold rounded-full shadow-lg hover:bg-pink-600 transition-colors duration-300 transform hover:scale-105';
                continueButton.textContent = 'Lanjut';
                continueButton.style.zIndex = '25'; // Ensure button is above confetti
                continueButton.style.position = 'fixed'; // Position it relative to viewport
                continueButton.style.bottom = '50px'; // Adjust position
                continueButton.style.left = '50%';
                continueButton.style.transform = 'translateX(-50%)';
                continueButton.style.opacity = '0'; // Start hidden for fade-in
                continueButton.style.transition = 'opacity 0.5s ease-in-out'; // Add transition
                document.body.appendChild(continueButton); // Append to body
                
                // Fade in the button
                setTimeout(() => {
                    continueButton.style.opacity = '1';
                }, 100); // Small delay to ensure transition applies

                continueButton.addEventListener('click', showLetterAndCollage);
            }, 2500); // Wait for all confetti to finish + a little extra

            // Play music and show illustration only if not played yet (triggered by user interaction)
            if (!musicPlayedOnce) {
                backgroundMusic.volume = 0.5; // Set initial volume
                backgroundMusic.play().then(() => {
                    musicIllustration.style.opacity = '1'; // Show music illustration
                    musicPlayedOnce = true;
                    console.log("Music started playing from triggerEndAnimation and illustration shown.");
                }).catch(e => {
                    console.error("Music autoplay from triggerEndAnimation was prevented:", e);
                });
            }
        }

        // Function to show the letter and collage with smooth transition
        function showLetterAndCollage() {
            const messageElement = document.getElementById('countdown-message');
            const continueButton = document.getElementById('continueButton');
            const letterAndCollageContainer = document.getElementById('letterAndCollageContainer');

            // Fade out the message and continue button
            messageElement.style.opacity = '0';
            if (continueButton) { // Check if button exists before trying to fade
                continueButton.style.opacity = '0';
            }
            
            // After fade out, hide them and show the new container with fade-in
            setTimeout(() => {
                messageElement.classList.add('hidden');
                if (continueButton) {
                    continueButton.classList.add('hidden');
                }

                letterAndCollageContainer.classList.remove('hidden'); // Make it visible
                letterAndCollageContainer.classList.add('visible'); // Trigger fade-in
                displayCollageImages(); // Display all collage images statically
                displayPoemLines(); // Start poem typing animation
            }, 500); // Match this duration with the CSS transition duration
        }

        // Quiz logic
        const submitQuizButton = document.getElementById('submitQuizButton');
        submitQuizButton.addEventListener('click', checkQuizAnswers);

        // Function to populate day, month, and year dropdowns
        function populateDateDropdowns(dayId, monthId, yearId, startYear, endYear) {
            const daySelect = document.getElementById(dayId);
            const monthSelect = document.getElementById(monthId);
            const yearSelect = document.getElementById(yearId);

            // Populate Days
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                daySelect.appendChild(option);
            }

            // Populate Months
            const monthNames = [
                "Januari", "Februari", "Maret", "April", "Mei", "Juni",
                "Juli", "Agustus", "September", "Oktober", "November", "Desember"
            ];
            monthNames.forEach((name, index) => {
                const option = document.createElement('option');
                option.value = index + 1; // Month index + 1 for actual month number
                option.textContent = name;
                monthSelect.appendChild(option);
            });

            // Populate Years
            for (let i = endYear; i >= startYear; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }

            // Add default "Pilih..." option
            const defaultDayOption = document.createElement('option');
            defaultDayOption.value = '';
            defaultDayOption.textContent = 'Hari';
            defaultDayOption.selected = true;
            defaultDayOption.disabled = true;
            daySelect.prepend(defaultDayOption);

            const defaultMonthOption = document.createElement('option');
            defaultMonthOption.value = '';
            defaultMonthOption.textContent = 'Bulan';
            defaultMonthOption.selected = true;
            defaultMonthOption.disabled = true;
            monthSelect.prepend(defaultMonthOption);

            const defaultYearOption = document.createElement('option');
            defaultYearOption.value = '';
            defaultYearOption.textContent = 'Tahun';
            defaultYearOption.selected = true;
            defaultYearOption.disabled = true;
            yearSelect.prepend(defaultYearOption);
        }

        // Initialize date dropdowns on page load
        document.addEventListener('DOMContentLoaded', () => {
            const currentYear = new Date().getFullYear();
            populateDateDropdowns('q2-day', 'q2-month', 'q2-year', 2010, currentYear); // For Jadian date
            populateDateDropdowns('q3-day', 'q3-month', 'q3-year', 2010, currentYear); // For Menikah date
        });

        function normalizeAnswer(answer) {
            // Convert to lowercase, trim whitespace, remove extra spaces and punctuation
            return answer.toLowerCase().trim()
                         .replace(/\s+/g, ' ') // Replace multiple spaces with single space
                         .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,""); // Remove common punctuation
        }

        function checkQuizAnswers() {
            const q1Answer = normalizeAnswer(document.getElementById('q1').value);
            
            // Get values from date dropdowns for q2
            const q2Day = document.getElementById('q2-day').value;
            const q2Month = document.getElementById('q2-month').value;
            const q2Year = document.getElementById('q2-year').value;
            let q2Answer = '';
            if (q2Day && q2Month && q2Year) {
                const monthName = new Date(q2Year, q2Month - 1).toLocaleString('id-ID', { month: 'long' });
                q2Answer = normalizeAnswer(`${q2Day} ${monthName} ${q2Year}`);
            }

            // Get values from date dropdowns for q3
            const q3Day = document.getElementById('q3-day').value;
            const q3Month = document.getElementById('q3-month').value;
            const q3Year = document.getElementById('q3-year').value;
            let q3Answer = '';
            if (q3Day && q3Month && q3Year) {
                const monthName = new Date(q3Year, q3Month - 1).toLocaleString('id-ID', { month: 'long' });
                q3Answer = normalizeAnswer(`${q3Day} ${monthName} ${q3Year}`);
            }

            const correctAnswers = {
                q1: '2014',
                q2: '14 september 2016',
                q3: '29 november 2022'
            };

            let allCorrect = true;
            let incorrectMessages = [];

            if (q1Answer !== normalizeAnswer(correctAnswers.q1)) {
                allCorrect = false;
                incorrectMessages.push("Jawaban pertanyaan 1 salah.");
            }
            if (q2Answer !== normalizeAnswer(correctAnswers.q2)) {
                allCorrect = false;
                incorrectMessages.push("Jawaban pertanyaan 2 salah.");
            }
            if (q3Answer !== normalizeAnswer(correctAnswers.q3)) {
                allCorrect = false;
                incorrectMessages.push("Jawaban pertanyaan 3 salah.");
            }

            if (allCorrect) {
                showModal("Selamat!", "Semua jawaban benar! Mari kita lanjutkan ke momen spesialmu.");
                // Delay showing the main animation slightly to allow modal to be read
                setTimeout(triggerEndAnimation, 2000); 
            } else {
                showModal("Ups!", "Ada jawaban yang salah. Coba lagi! " + incorrectMessages.join(" "));
            }

            // Play music on first interaction with the quiz (submit button click)
            if (!musicPlayedOnce) {
                backgroundMusic.volume = 0.5;
                backgroundMusic.play().then(() => {
                    musicIllustration.style.opacity = '1'; // Show music illustration
                    musicPlayedOnce = true;
                    console.log("Music started playing from quiz submit and illustration shown.");
                }).catch(e => {
                    console.warn("Music play on quiz submit was prevented:", e);
                });
            }
        }

        // --- Universal click listener for music playback ---
        // This attempts to play music on the very first user interaction with the document
        // This listener is crucial for autoplay policies in modern browsers.
        document.addEventListener('click', function playMusicOnFirstInteraction() {
            if (!musicPlayedOnce) {
                backgroundMusic.volume = 0.5;
                backgroundMusic.play().then(() => {
                    musicIllustration.style.opacity = '1'; // Show music illustration
                    musicPlayedOnce = true;
                    console.log("Music started playing from universal click listener and illustration shown.");
                    // Remove this listener once music has successfully played
                    document.removeEventListener('click', playMusicOnFirstInteraction);
                }).catch(e => {
                    console.warn("Music play on first interaction was prevented:", e);
                    // If still blocked, user might need to click the 'Lanjut' button or wait for quiz.
                });
            }
        }, { once: true }); // Use { once: true } to ensure it only runs once
    </script>
</body>
</html>
